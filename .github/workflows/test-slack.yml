name: Test Slack Notification

on:
  workflow_dispatch:

jobs:
  ping-slack:
    runs-on: ubuntu-latest
    steps:
      - name: üîé Check SLACK_WEBHOOK_URL secret
        run: |
          if [ -z "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
            echo "‚ùå Missing secret: SLACK_WEBHOOK_URL"
            exit 1
          else
            echo "‚úÖ SLACK_WEBHOOK_URL present"
          fi

      - name: üîî Slack ‚Äî test ping
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          payload=$(cat <<'JSON'
          {
            "text": "‚úÖ *MurMax Express¬Æ Slack test succeeded*",
            "blocks": [
              { "type": "section", "text": { "type": "mrkdwn", "text": "*MurMax Express¬Æ ‚Äî Slack test*" } },
              { "type": "section", "fields": [
                  { "type": "mrkdwn", "text": "*Repo:*\n${{ github.repository }}" },
                  { "type": "mrkdwn", "text": "*Run:*\n${{ github.run_id }}" },
                  { "type": "mrkdwn", "text": "*Branch:*\n${{ github.ref_name }}" },
                  { "type": "mrkdwn", "text": "*Commit:*\n${{ github.sha }}" }
              ]}
            ]
          }
          JSON
          )
          curl -sS -X POST -H 'Content-type: application/json' --data "$payload" "$SLACK_WEBHOOK_URL"
          echo "‚úÖ Slack payload sent"
